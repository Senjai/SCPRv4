<% page_title "Dashboard" %>

<div class="row">
  <div class="span9">
    <div class="clearfix">
      <h4 class="pull-left">Recently Saved by You</h4>
      <div class="pull-right">
        <%= link_to "View Your Activity", activity_admin_admin_user_path(admin_user), class: "btn" %>
      </div>
    </div>
        
    <%= any_to_list? @current_user_activities, message: "<div>There is no activity to show.</div>" do %>
      <table class="table table-striped">
        <thead>
          <tr>
            <th>Manage</th>
            <th>Title</th>
            <th>Timestamp</th>
            <th>Description</th>
          </tr>
        </thead>
        <tbody>
          <% @current_user_activities.each do |version| %>
            <% record = version.versioned %>
            <% if record.present? %>
              <tr>
                <td><%= link_to "Edit", record.admin_edit_path, class: "btn" %></td>
                <td><%= record.to_title %></td>
                <td><%= display_datetime(version.created_at) %></td>
                <td><%= version.description %></td>
              </tr>
            <% end %>
          <% end %>
        </tbody>
      </table>
    <% end %>
    <hr />
    
    <div class="clearfix">
      <h4 class="pull-left">Recently Saved by Others</h4>
      <div class="pull-right">
        <%= link_to "View All Activity", admin_activity_path, class: "btn" %>
      </div>
    </div>
    
    <%= any_to_list? @latest_activities, message: "There is no activity to show." do %>
      <table class="table table-striped">
        <thead>
          <tr>
            <th>Title</th>
            <th>Timestamp</th>
            <th>Description</th>
            <th>User</th>
          </tr>
        </thead>
        <tbody>
          <% @latest_activities.each do |version| %>
            <% record = version.versioned %>
            <% if record.present? %>
              <tr>
                <td><%= guarded_link_to record.class, record.to_title, url_for([:edit, :admin, record]) %></td>
                <td><%= display_datetime(version.created_at) %></td>
                <td><%= version.description %></td>
                <td><%= version.user.to_title %></td>
              </tr>
            <% end %>
          <% end %>
        </tbody>
      </table>
    <% end %>
    
    <hr />
  </div> <!-- span -->

  <div class="span3">
    <h4>Current Activity</h4>
    <hr />

    <div class="viewers" id="newsroom-dashboard_currently-active"></div>
  </div> <!-- span -->
</div> <!-- row -->

<% content_for :footer do %>
  <script type="text/javascript">
    newsroom = new scpr.Newsroom(
      "dashboard", // room ID
      <%= j admin_user.to_json.html_safe %>, // user info
      { "el": "#newsroom-dashboard_currently-active" }
    );
  </script>
<% end %>
