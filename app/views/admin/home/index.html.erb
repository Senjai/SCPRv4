<% page_title "KPCC Admin Dashboard" %>

<div class="row">
  <div class="span9">
    <h4 class="pull-left">Recently Saved by You</h4>
    <div class="pull-right">
      <%= link_to "View Your Activity", activity_admin_admin_user_path(admin_user), class: "btn" %>
    </div>
    
    <%= any_to_list? @current_user_activities, message: "There is no activity to show." do %>
      <table class="table table-striped">
        <thead>
          <tr>
            <th>Title</th>
            <th>Timestamp</th>
            <th>Description</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody>
          <% @current_user_activities.each do |version| %>
              <tr>
                <td><%= guarded_link_to version.versioned.class, version.versioned.to_title, url_for([:edit, :admin, version.versioned]) %></td>
                <td><%= display_datetime(version.created_at) %></td>
                <td><%= version.description %></td>
                <td><%= display_status(version.frozen_object.status) if version.frozen_object.respond_to? :status %></td>
              </tr>
          <% end %>
        </tbody>
      </table>      
    <% end %>

    <hr />
    
    <h4 class="pull-left">Recently Saved by Others</h4>
    <div class="pull-right">
      <%= link_to "View All Activity", admin_activity_path, class: "btn" %>
    </div>
    
    <%= any_to_list? @latest_activities, message: "There is no activity to show." do %>
      <table class="table table-striped">
        <thead>
          <tr>
            <th>Title</th>
            <th>Timestamp</th>
            <th>Description</th>
            <th>User</th>
          </tr>
        </thead>
        <tbody>
          <% @latest_activities.each do |version| %>
              <tr>
                <td><%= guarded_link_to version.versioned.class, version.versioned.to_title, url_for([:edit, :admin, version.versioned]) %></td>
                <td><%= display_datetime(version.created_at) %></td>
                <td><%= version.description %></td>
                <td><%= version.user.to_title %></td>
              </tr>
          <% end %>
        </tbody>
      </table>
    <% end %>
    
    <hr />
  </div> <!-- span -->

  <div class="span3">
    <h4>Current Activity</h4>
    <hr />

    <div class="viewers" id="newsroom-dashboard_currently-active"></div>
  </div> <!-- span -->
</div> <!-- row -->

<% content_for :footerjs do %>
  <script type="text/javascript">
    newsroom = new scpr.Newsroom(
      "dashboard", // room ID
      <%= j admin_user.to_json.html_safe %>, // user info
      { "el": "#newsroom-dashboard_currently-active" }
    );
  </script>
<% end %>
