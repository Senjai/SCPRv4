<% if @homepage %>
<%=
  begin
    render @homepage.base, homepage: @homepage
  rescue => e
    if Rails.env == "production"
      render "default", homepage: @homepage
    else
      raise e
    end
  end
%>
<% end %>

<%= yield :conversation_slot %>

<div class="more-content">
  <div class="row-fluid">
    <div class="span12 audiovision-block">

      <a class="logo" href="http://audiovision.scpr.org">
        <h6>AudioVision</h6>
      </a>

  <%= cache "homepage:audiovision" do %>
    <% if post = Array(Rails.cache.read("audiovision:featured-posts")).first %>

      <div class="cbase">
        <% if asset = post.assets.first %>
        <div class="asset-block">
          <div class="contentasset">
            <a href="<%= post.permalink %>">
              <img src="<%= asset.small.url %>" />
            </a>
          </div>
          
          <h4><%= asset.owner %></h4> 
        </div>
        <% end %>

        <h1 class="story-headline"><%= link_to post.title, post.permalink %></h1>
        <p><%= post.teaser.html_safe %></p>
      </div>

    <% end %>
  <% end %>
    
    </div> <!-- .audiovision -->

    <div class="span12">
      <%= render "/events/forum_events" %>
    </div>  
  </div>
</div>

<% content_for :missed_it do %>
  <% if @homepage and @homepage.missed_it_bucket.present? and @homepage.missed_it_bucket.content.present? %>
    <div class="more-news missed-it-bucket content-carousel">
      <h6 class="more-news-title">
        In Case You Missed It
        <div class="pager-nav">
          <a class="prev track-event" data-ga-category="Homepage" data-ga-action="In Cast You Missed It" data-ga-label="Nav Previous"></a>
          <a class="next track-event" data-ga-category="Homepage" data-ga-action="In Cast You Missed It" data-ga-label="Nav Next"></a>
        </div>
      </h6>
      <div class="carousel" data-current-page="1"></div>
    </div> <!-- missed-it-bucket -->
    
    <% content_for :footer do %>
      <script>var carousel = new scpr.ContentCarousel({dataUrl: "<%= homepage_missed_it_content_path(@homepage.id) %>"});</script>
    <% end %>
  <% end %>
<% end %>

<% content_for :lower do %>
  <%= raw Rails.cache.read("home/sections") %>
<% end %>
